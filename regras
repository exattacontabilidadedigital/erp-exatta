Regra de SugestÃ£o

Um match sugerido ocorre quando um lanÃ§amento do OFX e um lanÃ§amento do sistema possuem data e valor compatÃ­veis, com o mesmo sinal (entrada ou saÃ­da), mas nÃ£o atendem aos requisitos de transferÃªncia.

CritÃ©rios:

Data compatÃ­vel

A data do lanÃ§amento no OFX e no sistema deve ser idÃªntica ou estar dentro de uma tolerÃ¢ncia configurÃ¡vel.

Exemplo de tolerÃ¢ncia: atÃ© 3 dias de diferenÃ§a.

Valor compatÃ­vel

O valor do lanÃ§amento no OFX e no sistema deve ser igual ou estar dentro de uma tolerÃ¢ncia configurÃ¡vel de diferenÃ§a.

Exemplo de tolerÃ¢ncia: atÃ© R$ 2,00.

Mesmo sinal (entrada/saÃ­da)

Ambos devem ser receitas ou ambos devem ser despesas.

Exemplo:

OFX: +R$ 500,00

Sistema: +R$ 500,00 âœ… SugestÃ£o vÃ¡lida

OFX: -R$ 500,00

Sistema: -R$ 500,00 âœ… SugestÃ£o vÃ¡lida

OFX: -R$ 500,00

Sistema: +R$ 500,00 âŒ NÃ£o Ã© sugestÃ£o (seria analisado como transferÃªncia)

DescriÃ§Ã£o descartada

A descriÃ§Ã£o nÃ£o serÃ¡ usada como critÃ©rio de comparaÃ§Ã£o.

Regras adicionais:

Se os critÃ©rios de data, valor e sinal forem atendidos, o sistema classifica como SugestÃ£o (status roxo).

SugestÃµes nÃ£o sÃ£o conciliadas automaticamente â†’ o usuÃ¡rio deve clicar em Conciliar para confirmar.

Caso o usuÃ¡rio entenda que o match nÃ£o Ã© vÃ¡lido, pode usar:

Desvincular â†’ volta para Sem Match (branco).

Ignorar â†’ oculta o lanÃ§amento do OFX e o card correspondente do sistema.

ğŸ‘‰ Resumindo:
SugestÃ£o = Data prÃ³xima + Valor prÃ³ximo + Mesmo sinal (entrada/saÃ­da).




Regra de TransferÃªncia

Uma transferÃªncia ocorre quando o sistema identifica que um lanÃ§amento do OFX e um lanÃ§amento do sistema interno representam o mesmo movimento de transferÃªncia entre contas. Para classificar um par de lanÃ§amentos como transferÃªncia, os seguintes critÃ©rios devem ser atendidos simultaneamente:

CritÃ©rios obrigatÃ³rios:

DescriÃ§Ã£o contendo termos de transferÃªncia

O lanÃ§amento do OFX ou do sistema deve conter na descriÃ§Ã£o palavras-chave como:

"TRANSF", "TRANSFERÃŠNCIA", "TED", "DOC", "PIX TRANSF", ou termos semelhantes.

A lista de termos pode ser configurada em uma tabela de matching_rules, permitindo que o sistema aprenda e seja ajustado com o tempo.

Data exatamente igual

A data do lanÃ§amento no OFX e no sistema deve ser idÃªntica (mesmo dia).

TransferÃªncias sÃ£o movimentos simultÃ¢neos: saÃ­da em uma conta e entrada em outra no mesmo dia.

Valores iguais e opostos

O valor do lanÃ§amento do OFX e o do sistema devem ser iguais em absoluto, mas com sinais opostos:

Exemplo:

LanÃ§amento OFX: -R$ 1.000,00

LanÃ§amento Sistema: +R$ 1.000,00

Regras adicionais:

Se qualquer um dos 3 critÃ©rios nÃ£o for atendido, o par nÃ£o Ã© classificado como transferÃªncia.

O sistema apenas sugere a classificaÃ§Ã£o como transferÃªncia (status "transferÃªncia"), mas a conciliaÃ§Ã£o final sÃ³ ocorre quando o usuÃ¡rio clicar no botÃ£o Conciliar.

ApÃ³s a conciliaÃ§Ã£o, ambos os lanÃ§amentos recebem status Conciliado (cor verde).

Caso o usuÃ¡rio entenda que a sugestÃ£o nÃ£o estÃ¡ correta, ele pode usar o botÃ£o Desvincular, retornando o par para o status Sem Match (cor branca).

ğŸ‘‰ Resumindo:
TransferÃªncia = descriÃ§Ã£o com termo + mesma data + valores iguais e opostos.



Regra de Sem Match

Um lanÃ§amento Ã© classificado como Sem Match quando nÃ£o atende aos critÃ©rios de TransferÃªncia nem de SugestÃ£o.
Ou seja, o sistema nÃ£o encontrou nenhum par adequado para o lanÃ§amento importado do OFX.

CritÃ©rios de Sem Match

Data nÃ£o compatÃ­vel

DiferenÃ§a superior Ã  tolerÃ¢ncia configurÃ¡vel (ex.: mais de 3 dias de diferenÃ§a).

Valor nÃ£o compatÃ­vel

DiferenÃ§a superior Ã  tolerÃ¢ncia configurÃ¡vel (ex.: mais de R$ 2,00).

Sinal divergente (quando nÃ£o for transferÃªncia)

Exemplo:

OFX: -R$ 1.000,00

Sistema: +R$ 1.000,00

NÃ£o atende aos requisitos de TransferÃªncia nem de SugestÃ£o â†’ fica Sem Match.

AusÃªncia de par no sistema

O lanÃ§amento do OFX nÃ£o encontrou nenhum correspondente no sistema (nem sugestÃ£o, nem transferÃªncia).

Regras adicionais

ExibiÃ§Ã£o no frontend

Cards brancos (status: Sem Match).

Mostrados lado esquerdo (OFX) com um card vazio ou com opÃ§Ãµes de aÃ§Ã£o no lado direito.

AÃ§Ãµes disponÃ­veis ao usuÃ¡rio

Criar novo lanÃ§amento â†’ gera automaticamente um lanÃ§amento no sistema vinculado ao OFX.

Registrar como transferÃªncia â†’ permite o usuÃ¡rio marcar manualmente como transferÃªncia, escolhendo a conta de destino.

Buscar em outros perÃ­odos â†’ permite procurar lanÃ§amentos no sistema fora do perÃ­odo atual de conciliaÃ§Ã£o.

Ignorar â†’ oculta o lanÃ§amento (OFX + card do sistema correspondente) da tela de conciliaÃ§Ã£o.

PersistÃªncia no banco

Continua registrado em bank_transactions (OFX) e disponÃ­vel em reconciliation_sessions, mas com status Sem Match.

Se ignorado, o sistema marca como oculto sem excluir o registro.

ğŸ‘‰ Resumindo:
Sem Match = nÃ£o atende critÃ©rios de TransferÃªncia nem SugestÃ£o.

Regra de Cores para Entradas e SaÃ­das

Independente do status do card (Conciliado, SugestÃ£o, TransferÃªncia ou Sem Match), o valor exibido deve ter uma cor especÃ­fica para indicar se a transaÃ§Ã£o Ã© uma entrada ou uma saÃ­da.

CritÃ©rios:

Entrada (Receita)

Quando o valor do lanÃ§amento for positivo (ex.: crÃ©dito na conta).

Cor do valor: Verde.

Classe Tailwind: text-green-600 ou text-green-700.

Exemplo: +R$ 1.250,00.

SaÃ­da (Despesa)

Quando o valor do lanÃ§amento for negativo (ex.: dÃ©bito na conta).

Cor do valor: Vermelho.

Classe Tailwind: text-red-600 ou text-red-700.

Exemplo: -R$ 800,00.

Regras adicionais:

O card mantÃ©m sua cor de status (Conciliado = verde, SugestÃ£o = roxo, TransferÃªncia = azul, Sem Match = branco).

O valor dentro do card deve sempre respeitar a regra de entrada/saÃ­da:

Verde â†’ entrada.

Vermelho â†’ saÃ­da.

Essa regra vale tanto para o lado esquerdo (OFX) quanto para o lado direito (sistema).

Em caso de transferÃªncia, os dois cards devem mostrar valores em cores opostas:

Exemplo:

OFX: -R$ 1.000,00 (vermelho)

Sistema: +R$ 1.000,00 (verde)

ğŸ‘‰ Resumindo:

Entrada â†’ Verde

SaÃ­da â†’ Vermelho

Sempre aplicado ao valor, independente do status do card.

# ğŸ¨ Regras de Cores dos Cards

Cada card no front-end da conciliaÃ§Ã£o bancÃ¡ria segue **duas lÃ³gicas distintas de cor**:

---

## 1. Cor do Fundo do Card â†’ Status do Match

- **Conciliado** â†’ Fundo **Verde claro** (`bg-green-100`)  
- **SugestÃ£o** â†’ Fundo **Roxo claro** (`bg-purple-100`)  
- **TransferÃªncia** â†’ Fundo **Azul claro** (`bg-blue-100`)  
- **Sem Match** â†’ Fundo **Branco** (`bg-white`)  

---

## 2. Cor do Valor dentro do Card â†’ Tipo do LanÃ§amento

- **Entrada (Receita)** â†’ Texto **Verde escuro** (`text-green-700`)  
- **SaÃ­da (Despesa)** â†’ Texto **Vermelho escuro** (`text-red-700`)  

---

## 3. CombinaÃ§Ã£o Visual

O fundo do card **nunca muda** baseado no valor, somente pelo **status**.  
O valor dentro do card segue **verde ou vermelho** conforme **entrada ou saÃ­da**.

| Status do Card      | Cor do Fundo   | Entrada (Receita) | SaÃ­da (Despesa) |
|---------------------|----------------|-------------------|-----------------|
| Conciliado          | Verde claro    | Texto verde       | Texto vermelho  |
| SugestÃ£o            | Roxo claro     | Texto verde       | Texto vermelho  |
| TransferÃªncia       | Azul claro     | Texto verde       | Texto vermelho  |
| Sem Match           | Branco         | Texto verde       | Texto vermelho  |

---

## 4. Caso Especial: TransferÃªncia

- Sempre ocorre em **par** (um lanÃ§amento de saÃ­da e outro de entrada).  
- Exemplo visual:  
  - Lado esquerdo (OFX): `-R$ 1.000,00` â†’ texto vermelho  
  - Lado direito (Sistema): `+R$ 1.000,00` â†’ texto verde  
- Ambos os cards terÃ£o fundo **Azul claro** (`bg-blue-100`).

# ğŸ”˜ Regras dos BotÃµes na ConciliaÃ§Ã£o

Os botÃµes disponÃ­veis em cada card dependem do **status do match**.  
A lÃ³gica Ã© sempre respeitar o fluxo: **Match â†’ Conciliar â†’ Desconciliar/Desvincular/Igorar**.

---

## 1. Card Conciliado (Verde)
- **BotÃ£o disponÃ­vel:**  
  - `Desconciliar` â†’ desfaz a conciliaÃ§Ã£o, volta para **SugestÃ£o/TransferÃªncia** (dependendo da origem do match).

- **tag/botÃ£o disponÃ­veis no card do ofx no canto direito inferior:**  
- Ignorar.

---

## 2. Card SugestÃ£o (Roxo)
- **BotÃµes disponÃ­veis:**  
  - `Conciliar` â†’ confirma a sugestÃ£o e muda status para **Conciliado (Verde)**.  
  - `Desvincular` â†’ desfaz o match, volta para **Sem Match (Branco)**.  

  - **tag/botÃ£o disponÃ­veis no card do ofx no canto direito inferior:**
  - `Ignorar` â†’ oculta o lanÃ§amento do OFX e o card correspondente do sistema.  

---

## 3. Card TransferÃªncia (Azul)
- **BotÃµes disponÃ­veis:**  
  - `Conciliar` â†’ confirma a transferÃªncia e muda status para **Conciliado (Verde)**.  
  - `Desvincular` â†’ desfaz o match, volta para **Sem Match (Branco)**.  

- **tag/botÃ£o disponÃ­veis no card do ofx no canto direito inferior:**
  - `Ignorar` â†’ oculta o lanÃ§amento do OFX e o card correspondente do sistema.  

---

## 4. Card Sem Match (Branco)
- **BotÃµes disponÃ­veis dentro do card do lado direito:**  
  - `Criar LanÃ§amento` â†’ gera um novo lanÃ§amento no sistema a partir do OFX.  
  - `Nova TransferÃªncia` â†’ permite criar manualmente um par de transferÃªncia.  
  - `Buscar LanÃ§amento` â†’ pesquisa lanÃ§amentos em perÃ­odos diferentes para tentar conciliar.  
  
- **BotÃµes disponÃ­veis entre os card do status sem match:**  
  - `Ignorar` â†’ oculta o lanÃ§amento do OFX e o card correspondente do sistema.  

---

# ğŸ”„ Regras Gerais de Comportamento dos BotÃµes
1. **Conciliar**  
   - DisponÃ­vel apenas para **SugestÃ£o (Roxo)** ou **TransferÃªncia (Azul)**.  
   - Ao confirmar, muda status para **Conciliado (Verde)**.  

2. **Desconciliar**  
   - DisponÃ­vel apenas para **Conciliado (Verde)**.  
   - Volta o par para o status anterior (SugestÃ£o ou TransferÃªncia).  

3. **Desvincular**  
   - DisponÃ­vel para **SugestÃ£o (Roxo)** e **TransferÃªncia (Azul)**.  
   - Desfaz o match e volta para **Sem Match (Branco)**.  

4. **Ignorar**  
   - DisponÃ­vel para todos os status exceto **Conciliado (Verde)**.  
   - Oculta o lanÃ§amento do OFX e o card do sistema.  

5. **Criar LanÃ§amento / Nova TransferÃªncia / Buscar LanÃ§amento**  
   - DisponÃ­veis apenas para **Sem Match (Branco)**.  


# ğŸš« Regra de NÃ£o Duplicidade de LanÃ§amentos

## 1. RestriÃ§Ãµes de Uso
- Um **lanÃ§amento do sistema** sÃ³ pode ser usado em **um Ãºnico match** (seja SugestÃ£o, TransferÃªncia ou Conciliado).  
- ApÃ³s ser utilizado, ele nÃ£o pode ser reutilizado em outro par de conciliaÃ§Ã£o.  

---

## 2. Efeito na Interface
- Na **lista de lanÃ§amentos** exibida no **modal "Buscar LanÃ§amento"**:
  - LanÃ§amentos **jÃ¡ conciliados ou vinculados** ainda aparecem na lista (para fins de transparÃªncia).  
  - PorÃ©m, o botÃ£o **Selecionar** deve estar **desabilitado** (`disabled`).  
  - O status visual deve indicar algo como:  
    - "JÃ¡ utilizado" ou "IndisponÃ­vel para conciliaÃ§Ã£o".  

- Apenas lanÃ§amentos **nÃ£o utilizados** aparecem com o botÃ£o **Selecionar habilitado**.  

---

## 3. Fluxo de UtilizaÃ§Ã£o
- Se o usuÃ¡rio tentar vincular um lanÃ§amento **jÃ¡ utilizado**, o sistema deve:
  - **Bloquear a aÃ§Ã£o**.  
  - Exibir mensagem clara: *"Este lanÃ§amento jÃ¡ foi utilizado em outra conciliaÃ§Ã£o"*.  

---

## 4. Fluxo de DesvinculaÃ§Ã£o
- Caso o usuÃ¡rio **Desvincule** ou **Desconcilie** um lanÃ§amento:
  - Ele volta a ficar **disponÃ­vel** para seleÃ§Ã£o em novos matches.  
  - O botÃ£o **Selecionar** no modal retorna a ficar **habilitado**.  

---

## 5. BenefÃ­cios
- Evita conciliaÃ§Ãµes duplicadas.  
- Garante consistÃªncia entre OFX e lanÃ§amentos do sistema.  
- DÃ¡ **transparÃªncia** ao usuÃ¡rio, mostrando todos os lanÃ§amentos (usados ou nÃ£o), mas controlando a disponibilidade via **botÃ£o de aÃ§Ã£o**.

